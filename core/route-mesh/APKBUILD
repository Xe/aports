# Contributor: Christine Dodrill <me@christine.website>
# Maintainer: Christine Dodrill <me@christine.website>
pkgname=route-mesh
pkgver=0.3.0
pkgrel=1
pkgdesc="HTTP routing mesh"
url="https://info.route.xeserv.us"
arch="x86_64"
license="MIT"
depends="ca-certificates"
makedepends=""
install=""
subpackages="$pkgname-runit:runit $pkgname-server:routed $pkgname-agent:agent"
source="
        run

        https://xena.greedo.xeserv.us/pkg/bin/route-v0.3-linux.tar.gz
       "
builddir="$srcdir/"
_builddir="$srcdir/"

build() {
	echo "nothing to do"
}

package() {
	install -D -m 755 "$srcdir"/route-cli "$pkgdir"/usr/bin/route-cli
}

routed() {
	cd "$_builddir"
	pkgdesc="$pkgname daemon"
	depends=""               

	install -D -m 755 "$srcdir"/routed "$subpkgdir"/usr/bin/routed
	setcap cap_net_bind_service=+ep "$subpkgdir"/usr/bin/routed
}

agent() {
	cd "$_builddir"
	pkgdesc="$pkgname agent"

	install -D -m 755 "$srcdir"/route-httpagent "$subpkgdir"/usr/bin/route-httpagent
}

runit() {
	cd "$_builddir"
	pkgdesc="$pkgname agent runit bindings"
	depends="$pkgname-agent runit"
	source="run"

	install -D -m 755 "$srcdir"/run "$subpkgdir"/etc/system/$pkgname/run 
}

sha512sums="fabce2527312bd679e45cd23029b750d26d33adc32a9635b262d443f4ac5bcec40c3694efdba1c70fc1d38e1dc7001cb4ab3c2f39c73adfde0fe53ca20320fda  run
97829b1ee3967b9caa32f135cf0f48f7d112dc7e6318c8eae43092c1de79824bd89be3a6988ff8cb5c7a29f52410b482deb5622001959949a22c137d1f2e7535  route-v0.3-linux.tar.gz"
